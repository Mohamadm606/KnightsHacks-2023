
<!---->
<html>
  <head>
    <title>Simple Map</title>
    <style>
    #map {
      height: 100%;
    }
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default">
      
    </script>

    <link rel="stylesheet" type="text/css" href="./style.css" />
    <script type="module" src="./index.js"></script>
  </head>
  <body>
    <div id="screen">
        <div id="map"></div>
    <div id="cat" style="position: absolute; top: 30px;right: 50px; border: 5px solid #045c5a; border-radius: 5px; padding: 3px; background-color:rgb(247, 247, 235);">
        <label style="border-right: 2px solid red; padding: 4px;">Choose Category</label>
        <button onclick="toggle()" id="level" value="1">1</button>
    </div>

    </div>
    
    <script>
        function toggle(){
            i=document.getElementById("level").value;
            document.getElementById("level").innerHTML=(parseInt(i)%5)+1
            document.getElementById("level").value=(parseInt(i)%5)+1
        }
    </script>

    
    <script>
      let map;
      async function initMap() {
        try {
          const googleMaps = await google.maps.importLibrary("maps");
  
          const {Polyline} = await google.maps.importLibrary("maps");

          map = new googleMaps.Map(document.getElementById("map"), {
            center: { lat: 37.0902, lng: -95.7129 },
            zoom: 4,
            scaleControl: true,
            gestureHandling: "none"
          });
  
          const drawingManager = new google.maps.drawing.DrawingManager({
            drawingMode: google.maps.drawing.OverlayType.POLYLINE,
            drawingControl: true, // Enable the drawing control panel
            drawingControlOptions: {
              position: google.maps.ControlPosition.TOP_CENTER,
              drawingModes: [
                google.maps.drawing.OverlayType.MARKER,
                google.maps.drawing.OverlayType.CIRCLE,
                google.maps.drawing.OverlayType.POLYGON,
                google.maps.drawing.OverlayType.POLYLINE,
                google.maps.drawing.OverlayType.RECTANGLE,
              ],
            },
            markerOptions: {
              icon: "https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png",
            },
            circleOptions: {
              fillColor: "#ffff00",
              fillOpacity: 1,
              strokeWeight: 5,
              clickable: false,
              editable: true,
              zIndex: 1,
            },
          });
  
          drawingManager.setMap(map);

          // add listener for when polyline is complete
          google.maps.event.addListener(drawingManager, "polylinecomplete", function (polyline) {
            console.log("eventhandled");
            // get path
            const path = polyline.getPath();
            let coordinates = [];
            let N = 10;

            // for coordinate in path, add lat and lang to coordinates
            for (let i = 0; i < path.getLength(); i++) {
              const latLng = path.getAt(i);
              coordinates.push({ lat: latLng.lat(), lng: latLng.lng() });
            }

            let prevEnd = [];
            for (let i = 1; i < coordinates.length; i++) {
              let x1 = coordinates[i - 1]['lat'], y1 = coordinates[i - 1]['lng'];
              let x2 = coordinates[i]['lat'], y2 = coordinates[i]['lng'];
              console.log(`x1: ${x1}, x2: ${x2}, y1: ${y1}, y21: ${y2} `)
              let xdiff = x2 - x1;
              let ydiff = y2 - y1;
              //const N = 6 * Math.sqrt(xdiff * xdiff + ydiff * ydiff);
              const N = 4

                const polygonOptions = {
                strokeColor: "#FF0000", // Stroke color of the polygon
                strokeOpacity: 0.8, // Stroke opacity
                strokeWeight: 2, // Stroke weight
                fillColor: "#FF0000", // Fill color of the polygon
                fillOpacity: 0.35, // Fill opacity
              };

              const drawnPolygons = []; // Array to store drawn polygons
              theta= (((x2 - x1)/(y2 - y1)))>0? Math.atan(Math.abs(((x2 - x1)/(y2 - y1)))):90+Math.atan(Math.abs(((x2 - x1)/(y2 - y1))))
               console.log(theta,'lll',(((x2 - x1)/(y2 - y1))),'kk',Math.atan((((x2 - x1)/(y2 - y1)))))
                if (prevEnd[0] && prevEnd[1]) {
                  const prevPoly = new google.maps.Polygon({
                paths: [
                  { lat: prevEnd[0]['lat'], lng: prevEnd[0]['lng']},
                  { lat: prevEnd[1]['lat'], lng: prevEnd[1]['lng']},
                  { lat: x1 - 5 *Math.cos(theta), lng: y1 + 5*Math.sin(theta)},
                  { lat: prevEnd[0]['lat'], lng: prevEnd[0]['lng']},
                ],
                strokeColor: "#FF0000",
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: "#FF0000",
                fillOpacity: 0.25,
              });
                prevPoly.setMap(map);
                }
               
                //placeCircle(x1 + xdiff * (j * 1.0 / N), y1 + ydiff * (j * 1.0 / N), 6, "#AFE1AF");
                            
                const poly = new google.maps.Polygon({
                paths: [
                  { lat: x1 + 5*Math.cos(theta) , lng: y1 - 5*Math.sin(theta)},
                  { lat: x1 - 5*Math.cos(theta), lng: y1+ 5*Math.sin(theta)},
                  { lat: x2 - 5*Math.cos(theta), lng: y2 +5*Math.sin(theta)},
                  { lat: x2 + 5*Math.cos(theta), lng: y2 - 5*Math.sin(theta)},
                  { lat:x1 + 5*Math.cos(theta) , lng: y1 - 5*Math.sin(theta)}
                ],
                strokeColor: "#FF0000",
                strokeOpacity: 0.7,
                strokeWeight: 0,
                fillColor: "#FF0000",
                fillOpacity: 0.35,
              });

              prevEnd = [{lat: x2 + 5*Math.cos(theta), lng: y2 - 5*Math.sin(theta)}, {lat: x2 , lng: y2}];



              console.log({ lat: y1, lng: x1},
                  { lat: 5*Math.cos(Math.atan(((x2 - x1)/(y2 - y1)))), lng: 5*Math.sin(Math.atan(((x2 - x1)/(y2 - y1))))},
                  { lat: 5*Math.cos(theta) , lng: 5*Math.sin(theta)},
                  { lat: y2, lng: x2},"hbhbkh");
            //   console.log(poly)

              poly.setMap(map);

      

            }

            // lower bound
            // for (let i = 1; i < coordinates.length; i++) {
            //   let x1 = coordinates[i - 1]['lat'], y1 = coordinates[i - 1]['lng'];
            //   let x2 = coordinates[i]['lat'], y2 = coordinates[i]['lng'];
            //   console.log(`x1: ${x1}, x2: ${x2}, y1: ${y1}, y21: ${y2} `)
            //   let xdiff = x2 - x1;
            //   let ydiff = y2 - y1;
            //   //const N = 6 * Math.sqrt(xdiff * xdiff + ydiff * ydiff);
            //   const N = 4

            //     const polygonOptions = {
            //     strokeColor: "#FF0000", // Stroke color of the polygon
            //     strokeOpacity: 0.8, // Stroke opacity
            //     strokeWeight: 2, // Stroke weight
            //     fillColor: "#FF0000", // Fill color of the polygon
            //     fillOpacity: 0.35, // Fill opacity
            //   };

            //   const drawnPolygons = []; // Array to store drawn polygons
            //   //
            //     if (prevEnd[0] && prevEnd[1]) {
            //       const prevPoly = new google.maps.Polygon({
            //     paths: [
            //       { lat: prevEnd[0]['lat'], lng: prevEnd[0]['lng']},
            //       { lat: prevEnd[1]['lat'], lng: prevEnd[1]['lng']},
            //       { lat: x1 - 5*Math.cos(Math.atan(((x2 - x1)/(y2 - y1)))), lng: y1 + 5*Math.sin(Math.atan(((x2 - x1)/(y2 - y1))))},
            //       { lat: prevEnd[0]['lat'], lng: prevEnd[0]['lng']},
            //     ],
            //     strokeColor: "#FF0000",
            //     strokeOpacity: 0.8,
            //     strokeWeight: 2,
            //     fillColor: "#FF0000",
            //     fillOpacity: 0.35,
            //   });
            //     prevPoly.setMap(map);
            //     }
            //     theta=Math.atan(abs(((x2 - x1)/(y2 - y1))))
              
            //     //placeCircle(x1 + xdiff * (j * 1.0 / N), y1 + ydiff * (j * 1.0 / N), 6, "#AFE1AF");
                            
            //     const poly = new google.maps.Polygon({
            //     paths: [
            //       { lat: x1, lng: y1},
            //       { lat: x1 - 5*Math.cos(Math.atan(((x2 - x1)/(y2 - y1)))), lng: y1 + 5*Math.sin(Math.atan(((x2 - x1)/(y2 - y1))))},
            //       { lat: x2 - 5*Math.cos(Math.atan(((x2 - x1)/(y2 - y1)))), lng: y2 + 5*Math.sin(Math.atan(((x2 - x1)/(y2 - y1))))},
            //       { lat: x2 , lng: y2},
            //       { lat: x1, lng: y1}
            //     ],
            //     strokeColor: "#FF0000",
            //     strokeOpacity: 0.7,
            //     strokeWeight: 0,
            //     fillColor: "#FF0000",
            //     fillOpacity: 0.35,
            //   });

            //   prevEnd = [{lat: x2 - 5*Math.cos(Math.atan(((x2 - x1)/(y2 - y1)))), lng: y2 + 5*Math.sin(Math.atan(((x2 - x1)/(y2 - y1))))}, {lat: x2 , lng: y2}];



            //   console.log({ lat: y1, lng: x1},
            //       { lat: y1, lng: x1},
            //       { lat: y2, lng: x2},
            //       { lat: y2, lng: x2});

            //   poly.setMap(map);

      

            // }



    });
    

    const polyline = new Polyline({
      strokeColor: "#FF0000",
      strokeOpacity: 1.0,
      strokeWeight: 2,
    });

    polyline.setMap(map);

        } catch (error) {
          console.error("Error loading Google Maps:", error);
        }
      }
      function placeCircle(latitude, longitude, radius, color) {
      const googleMaps = google.maps;
      const mapCenter = new googleMaps.LatLng(latitude, longitude);

      const circle = new googleMaps.Circle({
        center: mapCenter,
        radius: 80000 * radius, // Set the radius in meters (adjust as needed)
        fillColor: color,
        fillOpacity: 0.08,
        strokeWeight: 0,
        map: map,
      });
      }

      
  
      (function () {
        const script = document.createElement("script");
        script.type = "text/javascript";
        script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&v=weekly&callback=initMap&libraries=places,drawing,visualization`;
        script.async = true;
        script.defer = true;
        document.head.appendChild(script);
      })();
    </script>
  </body>
</html>

